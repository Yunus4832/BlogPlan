## Python 的虚拟环境

### § 概述

在 python 中，使用 pip 安装第三方的软件扩展包一般都是安装到全局环境中的，这样不同的 python 工程 
在运行时使用的实际上是同一个 python 解释器的环境，这带来了许多的问题。
- 所有的 python 项目依赖的第三方包集中安装在同一个目录下，使得 python 的存储第三方包的本地仓库变得臃肿;
- 不同的 python 项目对第三方包的版本有不同的需求，使用同一个全局环境可能会造成版本的冲突;
- python 项目无法独立于运行环境存在，一旦代码需要迁移，需要花费大量的时间配置环境，调试代码等。

因此，虚拟环境应运而生，虚拟环境实现的原理其实很简单，将系统环境中的 python 解释器和包管理工具等
复制一份到一个特定的目录，但是不保留系统环境中安装的第三方包，然后修改包管理工具安装第三方包的位置，
以此实现不同项目之间依赖包的相互独立。

如果每一次建立新的 python 工程我们都要手动进行这些操作，新建项目的操作就会变得十分繁琐，我们可以借助
第三方包方便的实现一个简单的虚拟环境，下面是一些使用虚拟环境的常用解决方案，我将逐一进行介绍。
- virtualenv
- virtualenvwrapper
- pipenv

### § virtualenv
#### 1 安装
可以使用 pip 在全局环境中安装 virtualenv, 命令如下：
```bash
# 以下是在 Linux 系统中的示例 
pip install virtualenv
```
这条命令虽然是 Linux 系统中的示例，但在 windows 系统中也适用，不同的是需要将包名替换成 `virtualenv-win`.

#### 2 帮助文档
如果已经成功安装 virtualenv，则可以在命令行中使用该命令了，使用如下命令可以查看使用帮助：
```bash
virtualenv --help
```
该命令可以简写为`virtualenv -h`。

#### 3 基本使用
##### 创建虚拟环境
当一切都准备就绪后，我们就可以开始创建我们需要的虚拟环境了，具体操作如下：
```bash
# 这里我们进入到我们自己定义的用于存储虚拟环境的目录
cd ~/venvs
# 创建虚拟环境，注意这里的 yunus 是虚拟环境的名称，取一个和项目相关的名字吧~
virtualenv yunus
```
创建好虚拟环境之后，我们可以检查一下我们创建的虚拟环境：
```bash
#查看当前目录，如果不是我们期望的目录请使用 cd 命令进入相应目录
pwd
# 列出当前目录中的所有文件及目录
ls -a
# 检查我们创建的虚拟环境，这里 yunus 即是我们创建的虚拟环境
tree yunus
```
输出如下：
```text

```
我们可以看到，创建的虚拟环境中存在一份复制的 python 解释器、包管理工具以及虚拟环境存储
第三方包的目录。

##### 在虚拟环境中安装第三方包
我们不能直接使用 pip 安装软件包，因为直接使用 pip 系统会首先从 path 环境变量所列出的目录寻找 pip.exe
可执行程序，但是我们只将系统中的 python 路径加入到了系统的 path 环境变量中，如果直接使用 pip 进行安装
将会把软件包安装到全局环境中而非虚拟环境中，因此我们需要指定使用虚拟环境中的 pip 安装软件包，具体操作
如下：

```bash
# 这里的 package-name 需要替换成需要安装的软件包
~/venvs/yunus/Scripts/pip install package-name
# 检查是否成功安装软件包
~/venvs/yunus/Scripts/pip list
~/venvs/yunus/Scripts/pip show package-name
```
我们看到在虚拟环境中安装软件包还是比较繁琐的，我们需要知道虚拟环境所在的位置和虚拟环境的名称，后面
我会介绍更加方便地方式安装和管理虚拟环境的方式。

##### 使用虚拟环境中的 python 解释器运行代码
使用虚拟环境运行代码和安装软件包存在相似的问题——系统无法找到我们虚拟环境中的 python 解释器，因此
我们也需要使用如下命令执行我们的 python 脚本：
```bash
# 使用虚拟环境中的 python 解释器执行脚本
~/venvs/yunus/python script.py
```

##### 移除虚拟环境
当我们需要删除一个我们不想要的虚拟环境是，其操作方式相当简单粗暴，直接删除即可，具体操作如下：
```bash
# 移除虚拟环境
rm -rf ~/venvs/yunus
```

##### 小结
我们发现，使用 virtualenv 可以帮助我们实现一个基本可用的 python 虚拟环境，但是其实现方式只是简单的
复制，在需要安装软件包，或运行代码时我们都需要指定虚拟环境中的包管理工具或解释器，但这已经足够我们
使用它满足我们对虚拟环境的需求，后面我们还将看到，其他的虚拟环境工具正是在 virtualenv 之上实现的更
加方便人性化的虚拟环境管理工具。喜欢精简的人员也许觉得 virtualenv 已经够用了，但是也不妨试试其他的
在此基础之上实现的工具进一步提高效率。


### § virtualenvwrapper

### § pipenv

### § 参考 & 引用
- [如何使用 virtualenv 创建 Python 虚拟环境](https://zhuanlan.zhihu.com/p/269805011)
